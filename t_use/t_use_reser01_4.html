<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>시즌이용권</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link rel="stylesheet" href="/t_use/css/t_use_reser01_4.css">
</head>
<body>
    <div class="ticket_formWrap season_ticket_formWrap">
        <div class="season_form_title form_title">
            <h4>시즌이용권 구매하기</h4>
        </div>
        <form action="" id="season_ticket_form" class="ticket_form" data-typetext="시즌이용권 구매" data-type="4">
          <fieldset class="season_fieldset01">
            <legend>이용권 선택</legend>
            
            <div class="sf01_labelexp">
              <ul>
                <li>
                  <div class="sf01_labelexp_img">
                    <img src="/image/t_use_reser01_4/season_pass.jpg" alt="">
                  </div>
                  <div>
                    <div class="sf01_labelexp_title">
                      <strong>SUMMER 시즌 패스</strong>
                      <span>8만 9천원으로! 여름을 신나게!<br/>
                        내 마음대로 무제한으로 즐길 수 있는 "갓성비" 시즌패스!<br/>
                        오직 6월 30일까지 기간 한정 판매!</span>
                    </div>
                    <div class="sf01_labelexp_detail">
                      <ul>
                        <li>판매가: 8만 9천원</li>
                        <li>판매일: 2023년 5월 12일 ~ 6월 30일</li>
                        <li>이용 기간: 2023년 6월 12일 ~ 9월 3일 (총 84일)</li>
                        <li>이용 제한일: 별도 없음</li>
                        <li>
                          방문 예약 후 파크 입장 가능
                          <span>( 방문 예약 시작일자 : 2023년 5월 12일 이후 )</span>
                        </li>
                      </ul>
                    </div>
                  </div>
                </li>
                <li>
                  <div class="sf01_labelexp_img">
                    <img src="/image/t_use_reser01_4/spring-season-pass-1.webp" alt="">
                  </div>
                  <div>
                    <div class="sf01_labelexp_title">
                      <strong>SPRING 시즌 패스</strong>
                      <span>봄 시즌을 무제한*으로 즐길 수 있는 갓성비 시즌패스!<br/>
                        오직 3월 23일까지 기간 한정 판매! (*입장 제한일 적용)</span>
                    </div>
                    <div class="sf01_labelexp_detail">
                      <ul>
                        <li>판매일: 2023년 2월 24일 ~ 3월 23일</li>
                        <li>이용기간: 2023년 3월 24일 ~ 6월 11일 (총 76일)</li>
                        <li>이용 제한일: 2023년 5월 5일 ~ 6일, 6월 4일 (총 3일)</li>
                        <li>방문예약 후 파크 입장 가능
                          <span>( 방문 예약 일자 : 2023년 3월 10일 이후 )</span>
                        </li>
                      </ul>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
            <div class="sf01_tcWrap">
              <div class="sf01_ticketcard summer">
                <a href="#none" class="sf01_tc_select">
                  <img src="/image/t_use_reser01_4/summer_season_re.png" alt="">
                </a>
                <span class="sf01_tc_title">SUMMER SEASON PASS</span>
                <div class="sf01_tc_number">
                  <div class="sf01_tc_exp">
                    ￦ 89,000
                  </div>
                  <div class="numberCheck">
                    <input
                      type="number"
                      name="number.SUMMER SEASON PASS"
                      id="season_summer_number"
                      value="0"
                      readonly
                    />
                    <a href="#none" class="decrease_btn">수량 제외<img src="/image/t_use_reser01_4/minus.png" alt=""></a>
                    <a href="#none" class="increase_btn">수량 추가<img src="/image/t_use_reser01_4/plus.png" alt=""></a>
                  </div>
                </div>
                
              </div>
              <div class="sf01_ticketcard spring">
                <a href="#none" class="sf01_tc_select">
                  <img src="/image/t_use_reser01_4/spring_season_re.jpg" alt="">
                </a>
                <span class="sf01_tc_title">SPRING SEASON PASS</span>
                <div class="sf01_tc_number">
                  <div class="sf01_tc_exp">
                    ￦ 89,000
                  </div>
                  <div class="numberCheck">
                    <input
                      type="number"
                      name="number.SPRING SEASON PASS"
                      id="season_spring_number"
                      value="0"
                      readonly
                    />
                    <a href="#none" class="decrease_btn">수량 제외<img src="/image/t_use_reser01_4/minus.png" alt=""></a>
                    <a href="#none" class="increase_btn">수량 추가<img src="/image/t_use_reser01_4/plus.png" alt=""></a>
                  </div>
                </div>
                
                <div class="sf01_tc_disabled">
                  <strong>다음 시즌에 만나요!</strong>
                  <strong>이용권 판매 종료</strong>
                  <span>2023년 2월 24일 ~ 2023년 3월 23일</span>
                </div>
              </div>
            </div>
            <div class="sf01_exp">
              <dl>
                <dt>유의사항</dt>
                <dd>식음료, 리테일 및 호텔 할인 등 별도 혜택 미적용 상품</dd>
                <dd>유효기간 내 현장 매표소에서 연간 이용권(골드, 플래티넘)으로 차액 결제 후 업그레이드 가능</dd>
                <dd>방문 예약 후 파크 입장 가능</dd>
                <dd>만12세 이하 어린이는 입장 및 이용 시 만16세 이상의 보호자 동반 입장 필수</dd>
                <dd>주차장 이용료 별도 부과</dd>
                <dd>천재지변, 악천후, 기구 안전 점검, 내부 공사 사정 등에 따라 파크 미운영일이 발생할 수 있음</dd>
                <dd>이후 일자에 대한 시즌패스 출시 예정</dd>
                <dd>시즌패스는 구매일과 관계없이 만료일이 동일하며, 썸머패스는 9월 3일 일괄 자동 만료</dd>
              </dl>
            </div>
          </fieldset>

          <fieldset class="season_fieldset02 fieldset02">
            <legend>정보 입력</legend>
            <div class="sf02_wrap">
              <div class="sf02_inputBox">
                <div class="i_info_origin">
                  <div class="i_i_tab">
                    <div class="i_i_t_name"></div>
                    <div class="i_i_t_ticket"></div>
                    <div class="i_i_t_age"></div>
                    <input type="hidden" name="type">
                    <a href="#none">취소</a>
                  </div>
                  <div class="i_i_inputpage_wrap">
                    <div class="i_i_inputpage">
                      <div class="user_name">
                        <label for="">이름</label>
                        <input type="text" name="name" id="" >
                      </div>
                      <div class="user_birthday">
                        <span>생년월일</span>
                        <input type="number" name="birthYear" maxlength="4" placeholder="0000" id="">
                        <label for="">년</label>
                        <input type="number" name="birthMonth" maxlength="2" min="1" max="12" placeholder="00" id="">
                        <label for="">월</label>
                        <input type="number" name="birthDate" maxlength="2" min="1" max="31" placeholder="00" id="">
                        <label for="">일</label>
                      </div>
                      <div class="user_phone">
                        <label for="">전화번호</label>
                        <input type="tel" name="phone" maxlength="20" placeholder="' - ' 빼고 입력하세요." id="">
                      </div>
                      <div class="user_email">
                        <label for="">이메일</label>
                        <input type="email" name="email" placeholder="ex. example@example.com" id="">
                      </div>
                      <div class="user_nationality_select">
                        <label for="">국가</label>
                        <input type="text" name="nationality" id="" placeholder="국가 선택" readonly>
                        <ul>
                          <li><a href="#none">대한민국</a></li>
                          <li><a href="#none">미국</a></li>
                          <li><a href="#none">오스트레일리아</a></li>
                          <li><a href="#none">일본</a></li>
                          <li><a href="#none">홍콩</a></li>
                          <li><a href="#none">중국</a></li>
                          <li><a href="#none">대만</a></li>
                          <li><a href="#none">싱가포르</a></li>
                          <li><a href="#none">오스트리아</a></li>
                          <li><a href="#none">필리핀</a></li>
                          <li><a href="#none">말레이시아</a></li>
                          <li><a href="#none">영국</a></li>
                          <li><a href="#none">태국</a></li>
                        </ul>
                      </div>
                      <div class="user_states">
                        <label for="">도/특별시/시</label>
                        <input type="text" name="states" id="">
                      </div>
                      <div class="user_city">
                        <label for="">시/군/구</label>
                        <input type="text" name="city" id="">
                      </div>
                      <div class="user_photo">
                        <span>패스 사진 등록</span>
                        <input type="hidden" name="photo" class="user_photo_submitOnly">
                        <div class="user_photo_img_wrap">
                          <canvas class="user_photo_canvas" width="0" height="0"></canvas>
                          <div class="user_photo_cut">
                            <div class="user_photo_cut_size"></div>
                          </div>
                        </div>
                        <div class="user_photo_notice">* '사진 업로드' 버튼을 눌러 사진을 등록하십시오. 연간회원권 등록을 완료하려면 사진이 필요합니다</div>
                        <div class="user_photo_input">
                          <input type="file" name="" class="user_photo" accept="image/png, image/jpeg, image/webp" style="display:none">
                          <a href="#none" class="user_photo_upload">사진 업로드</a>
                          <a href="#none" class="user_photo_slideBtn">잘라내기</a>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </fieldset>

          <fieldset class="season_fieldset06 total_price_wrap">
            <legend>가격 합계</legend>
            <div class="discount">
              <span>할인 적용</span>
              <ul class="d_list">
                <li class="empty_li">관련 혜택 없음</li>
              </ul>
            </div>

            <div class="price">
              <div class="p_selectlist">
                <ul>
                  <li class="p_s_box">
                    <strong>구매 수량</strong>
                    <div class="p_s_numbers">
                      
                    </div>
                  </li>
                  <li class="p_s_box">
                    <strong>할인 내역</strong>
                    <div class="p_s_discount">
                      <div>
                        <p class="p_s_e_title06"></p>
                        <p class="p_s_e_number06"></p>
                        <p class="p_s_e_price06"></p>
                      </div>
                    </div>
                  </li>
                </ul>
              </div>
              <div class="p_total">
                <label for="season_total_price">합계</label>
                <span class="p_t_text">￦ 0</span>
                <input type="text" name="total_price.합계" id="season_total_price" readonly class="total_price">
              </div>
              <div class="season_ticket_submit ticket_submit">
                <button type="submit" class="submit_btn">장바구니에 담기</button>
                <button type="button" class="reset_btn">다시 입력</button>
              </div>
            </div>
          </fieldset>
        </form>
    </div>
    <script>
        $(function(){
            
            // for Total Price ----------
            var discountRate = 1;
            var sf01_price = [0,0,0];
            var af04_price = [0,0,0];
            function comma(x) {
              return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }
          //------------Load-------------
          $(".decrease_btn").click(function(e){
            if( $(this).siblings("input").val() > 0) {
              $(this).siblings("input").val((i,v) => +v-1);
              $(this).siblings("input").trigger("change");           
            }
          })
          $(".increase_btn").click(function(e){
            $(this).siblings("input").val((i,v) => +v+1);
            $(this).siblings("input").trigger("change");
          });
          //---------------------------- 01. 이용권 선택
          $(".sf01_ticketcard").on("mouseover",function(){
            const idx = $(".sf01_ticketcard").index($(this));
             $(".sf01_labelexp >ul>li").eq(idx).css("display","flex");
             $(".sf01_labelexp >ul>li").not(`:eq(${idx})`).css("display","none");
          })

            $(".sf01_tc_number input").each(function(i){
              const $newDiv = $("<div><p class='p_s_n_title'></p><p class='p_s_n_number'></p><p class='p_s_n_price'></p></div>");
              $(".p_s_numbers").append($newDiv);

              $(this).change(function(){
                if ( $(this).val() == 0 ) {
                  $newDiv.hide();
                } else {
                  $newDiv.show()
                  if ( i == 0 ) {
                    const price = 89000;
                    $(".p_s_n_title").eq(i).text("SUMMER PASS");
                    $(".p_s_n_number").eq(i).text($(this).val());
                    $(".p_s_n_price").eq(i).text("￦" + $(this).val() * price);
                    sf01_price[i] = $(this).val() * price;
                  }
                  if ( i == 1 ) {
                    const price = 89000;
                    $(".p_s_n_title").eq(i).text("SPRING PASS");
                    $(".p_s_n_number").eq(i).text($(this).val());
                    $(".p_s_n_price").eq(i).text("￦" + $(this).val() * price);
                    sf01_price[i] = $(this).val() * price;
                  }
                }
                total();
              })
            })
          // ------------------------------------- 02. 정보입력
          
          //photo
          let $w = $(".user_photo_cut").width()/2;
          let $h = $(".user_photo_cut").height()/2;
          // cut control
          $(".user_photo").each(function(i){
            const mousekey = {};
            $(this).find(".user_photo_cut_size")
            .on("mousedown", function(e){
              e.stopPropagation();
              mousekey["r"] = true;
            });
            $(document)
            .on("mouseup",function(){
              mousekey["d"] = false;
              mousekey["r"]=false;
            });
            $(this).children(".user_photo_img_wrap")
              .on("mousedown",".user_photo_cut",function(){
                mousekey["d"] = true;
              })
              .on("mouseleave", function(){
                mousekey["d"] = false;
                mousekey["r"]=false;
              })
              .on("mousemove",function(e){
              //move cut
              const cut = $(this).find(".user_photo_cut");
              const pt = $(this).children("canvas").offset().top, pl = $(this).children("canvas").offset().left, ph = $(this).children("canvas").height(), pw = $(this).children("canvas").width();
              let ex = event.movementX, ey = event.movementY,
                widen = ex*ex > ey*ey? ex : ey;
              let ct = cut.offset().top, cl = cut.offset().left,
                ch = cut.height(), cw = cut.width();
              if(mousekey["d"]){
                if(ct < pt){ cut.offset({top: pt+1}); }
                else if(ct+ch >= pt+ph){ cut.offset({top: pt+ph-ch-1}); }
                else { cut.offset({top: ct+ey}); }

                if(cl < pl){ cut.offset({left: pl+1}); }
                else if(cl+cw >= pl+pw){ cut.offset({left: pl+pw-cw-1}); }
                else { cut.offset({left: cl+ex}); }
              }
              //resize cut
              if(mousekey["r"]){
                if(cl+cw < pl+pw && ct+ch < pt+ph) {
                  cut.css({ width : `+=${widen}`, height: `+=${widen}` })
                } else {
                  cut.css({ width : cw-1, height: ch-1 })
                }
              }
            });
          })
          // 입력창 생성
          function makeInfo(classes) {
              if( $(`.i_info_${classes}`).length < $(`#season_${classes}_number`).val()) {
                const $makeInfo = $(`.i_info_origin`).clone(true);
                
                $makeInfo.addClass([`i_info_${classes}`, "i_info"]);
                $makeInfo.removeClass("i_info_origin");
                $makeInfo.find(".i_i_t_ticket").text(`${classes.toUpperCase()} SEASON PASS`);
                $makeInfo.find(".i_i_tab input").val((i,v) => classes);
                $(".sf02_inputBox").append($makeInfo);

                //제거버튼
                $makeInfo.find(".i_i_tab a").click(function(){
                  $makeInfo.remove();
                  $(`#season_${classes}_number`).val((i,v) => +v-1);
                });
              
                //국가 선택
                $makeInfo.find(".user_nationality_select input").on("click",function(){
                  $(this).siblings("ul").toggle();
                });
                $makeInfo.find(".user_nationality_select li a").click(function(){
                  $(this).parents(".user_nationality_select").find("input").val((i,v) => $(this).text());
                  $(this).parents(".user_nationality_select").find("ul").slideUp("fast");
                });
                $makeInfo.find(".user_name input").on("change",function(){
                  $makeInfo.find(".i_i_t_name").text(`사용자 이름 : ${$(this).val()}`);
                })
                // 슬라이드
                $makeInfo.find(".i_i_tab").on("click",function(){
                  $makeInfo.find(".i_i_inputpage_wrap").slideToggle();
                })
                //이미지
                $makeInfo.find(".user_photo")
                  .on("click",".user_photo_input a:eq(0)",function(){
                    $(this).siblings(".user_photo").trigger("click");
                  })
                  .on("change",".user_photo",function(event){
                    $makeInfo.find(".user_photo_cut").show();
                    const loader = event.target.files[0];
                    const reader = new FileReader();
                    reader.readAsDataURL(loader);
                    reader.onloadend = function(e){
                      const img = new Image();
                      img.src = e.target.result;
                      const can = $makeInfo.find(".user_photo_canvas");
                      can.data("originUrl",e.target.result);
                      img.onload = function(){
                        const iw = img.width, ih = img.height, max_canvas = can.parent().width();
                        const tw = iw<ih? max_canvas*iw/ih: max_canvas, th = iw<ih? max_canvas: max_canvas*ih/iw;
                        can.prop("width", tw).prop("height",th);
                        const ctx = can.get(0).getContext("2d");
                        ctx.drawImage(img, 0, 0,tw, th );
                      }
                    }
                  })
                  .on("click",".user_photo_input a:eq(1)",function(){
                    const finalCanvasSize = 200;
                    const can = $makeInfo.find(".user_photo_canvas");
                    const draw = can.get(0).getContext("2d");
                      draw.clearRect(0,0,can.width(),can.height());
                    const cut = $makeInfo.find(".user_photo_cut"),
                      ct = cut.position().top, cl = cut.position().left, cw = cut.width(), ch = cut.height(),
                      pw = cut.parent().width(), ph = cut.parent().height();
                    const iii = new Image();
                    iii.src = can.data("originUrl");
                    iii.onload = function(){
                      const iw = iii.width, ih = iii.height
                      can.prop("width", finalCanvasSize).prop("height",finalCanvasSize*cw/ch);
                      draw.drawImage(iii,cl*iw/pw,ct*ih/ph,cw*iw/pw,ch*ih/ph,0,0,finalCanvasSize,finalCanvasSize*cw/ch)
                      const da = can.get(0).toDataURL("image/png");
                      can.data("replaceUrl",da);
                      $makeInfo.find(".user_photo_submitOnly").val((i,v) => da);
                    }
                    
                  })                
                
              }
              // ------------------------------------------
              else if ($(`.i_info_${classes}`).length > $(`#season_${classes}_number`).val()) {
                $(`.i_info_${classes}`).last().remove();
              }
          }
          $("#season_summer_number").on("change",function(){
            const price = 89000;
            let n = $(this).val();
              //생성
            makeInfo("summer");
              //각 pass 갯수 입력
            const q = $("form").data("pass");
            q.summer = n;
            $("form").data("pass",q);
              // 가격 수정
            $(".p_s_n_number").eq(0).text(`￦ ${n}`);
            $(".p_s_n_price").eq(0).text(`￦ ${comma(n*price)}`);
            if(n==0) {
              $(".p_s_n_summer").hide();
            } else {
              $(".p_s_n_summer").show();
            }

          })
          $("#season_spring_number").on("change",function(){
            const price = 89000;
            makeInfo("spring");
              //각 pass 갯수 입력
            const q = $("form").data("pass");
            q.spring = n;
            $("form").data("pass",q);
            let n = $(this).val();
            $(".p_s_n_number").eq(1).text(`￦ ${n}`);
            $(".p_s_n_price").eq(1).text(`￦ ${comma(n*price)}`);
            if(n==0) {
              $(".p_s_n_spring").hide();
            } else {
              $(".p_s_n_spring").show();
            }
          })
          // ------------------------------------- 06-1. 할인적용
          $(".d_list li").each(function(i){
            $(this).find(".d_l_listopen").click(function(){
              $(".d_l_detail").eq(i).slideToggle();
              $(".d_l_detail").not(":eq("+i+")").slideUp()
              $(".d_l_w_exp").eq(i).slideToggle();
              $(".d_l_w_exp").not(":eq("+i+")").slideDown();
            })
          });

          
          $(".d_l_select").each(function(i){
            $(this).click(function(){
              $(".d_list li").eq(i).toggleClass("active_discount");
              $(".d_list li").not(`:eq(${i})`).removeClass("active_discount");
              $(".d_list li input:checkbox").eq(i).prop("checked",function(){
                $(".d_list li input:checkbox").not($(this)).prop("checked",false);
                return !$(this).prop("checked");
              });
              if ( $(".d_list li input:checkbox").eq(i).is(":checked")) {
                $(".p_s_discount > div").show();
              } else if (!$(".d_list li input:checkbox").is(":checked")) {
                $(".p_s_discount > div").hide();
              }
              total();
            });
          });
         

          // ------------------------------------- 06-2. 가격 합산
          
          const total = function() {

            

            $("#season_total_price").val(function(i,v) {
              if ($(".sf01_tc_number input").eq(1).val() >= 4) {
                sf01_price[1] *= discountRate;
              }
              const t_1 = sf01_price.reduce((a,b) => a+b);
              const t_2 = af04_price.reduce((a,b) => a+b);
              $(".p_t_text").text("￦"+comma(t_1+t_2));
              
              return t_1 + t_2
            })
            
          } 
          //페이지 리셋
        $(".reset_btn").click(function(){
          $(".formBox").load("/t_use/t_use_reser01_1.html");
        })
        });
    </script>
   <script src="/t_use/js/ticket_common.js"></script>
</body>
</html>